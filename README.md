# CookBook
Данное приложение было разработано в рамках курсового проекта "Программное обеспечение информационной безопасности мобильных систем". 

Цель курсового проекта: экономия времени пользователей путем хранения и использования рецептов в одном и доступном месте.

Мобильное приложение имеет простой, интуитивно понятный пользователю интерфейс и обладает следующими особенностями:
+ аутентификация FingerPrint;
+ обфускация проекта с помощью proguard;
+ запрет скриншотов и съёмки видео внутри приложения;
+ добавление новых рецептов;
+ просмотр всех рецептов и рецептов по категориям;
+ изменение существующих рецептов;
+ удаление рецепта;
+ поиск необходимого рецепта по названию;
+ предоставление полезной информации для готовки и таймер;
+ синхронизация с сервером.

# Мобильное приложение

https://github.com/sutulayaDog/CookBook/tree/main/ProjectBD/ProjectBD

Мобильное приложение было реализовано в среде разработки – Android Studio 3.0. Для написания приложения был использован язык программирования Java.

Для хранения данных на телефоне используется встраиваемая СУБД SQLite, а для обеспечения безопасности используется библиотека SQLCipher. 
Для создания базы данных реализавны классы DbHelper(управления базой данных) и DbProvider(представляет собой поставщик контента)
Мобильное и серверное приложение имеют общие структурные объекты:
+ Product – таблица продуктов;
+ Categorie – таблица категорий;
+ Recipe – таблица рецептов;
+ Product_In_Resipe – таблица хранящая продукты относящиеся к рецептам.
Также со стороны мобильного приложения необходимо было добавить
триггер «afterSetRemovedStatus_Remove», который при удалении рецепта меняет статус строк таблицы «ProductInResipe», относящихся к данному рецепту, на «R».


Для безопастности был реализован FingerPrint на главной странице мобильного приложения. 

![Image alt](https://github.com/sutulayaDog/CookBook/blob/main/%D1%84%D0%BE%D1%82%D0%BE4.jpg) 

Реализлвано это в классе MainActivity(активность с аутентификацией FingerPrint) с методами: 
+ generateKey (метод генерирующий ключ для шифрования), 
+ cipherInit(метод шифрующий данные), 
+ start_onClick (метод привязанный к событию нажатия на кнопку «Добро пожаловать») 
и классе FingerprintHandler(класс обрабатывающий результаты сенсора) с методами: 
+ onAuthenticationHelp(метод вызывающийся в случае грязных пальцев, недостаточно сильного зажима пальца), 
+ onAuthenticationFailed(метод вызывающийся в случае считывания отпечатка пальца, но он не верен),
+ onAuthenticationError(метод вызывающийся в случае нескольких неудачных считываний отпечатка пальца),
+ onAuthenticationSucceeded(метод вызывающийся в случае, если все прошло успешно).
Также в AndroidManifest необходимо было указать разрешение на использование FingerPrint: <uses-permission android:name="android.permission.USE_FINGERPRINT" />

После нажатия на кнопку «Добро пожаловать» откроется домашняя страница приложения. Для работы с приложением, вам необходимо выбрать «Синхронизация» в верхнем меню данной страницы. 

![Image alt](https://github.com/sutulayaDog/CookBook/blob/main/%D1%84%D0%BE%D1%82%D0%BE5.jpg) 

Синхронизация приложения с сервером реализована с помощью класса Synchronizer(сервис для синхронизации) с методами: 
+ onHandleIntent(метод отрабатывающий при старте сервиса),
+ SyncCategorieTable(метод синхронизации таблицы Categorie),
+ SyncProductTable(метод синхронизации таблицы Product),
+ SyncResipeTable(метод синхронизации таблицы Resipe),
+ SyncProductInResipeTable(метод синхронизации таблицы ProductInResipe). 
Также для синхронизации предусмотрены вспомогающие классы: 
+ Класс ArrayBuilder(преобразовает курсора в списки объектов) с методами: getCategories(метод возвращающий список категорий),getProducts(метод возвращающий список продуктов),getResipes(метод возвращающий список рецептов),getProductsInResipes(метод возвращающий список продуктов в рецепте).
+ Класс DateTime(работа с датой и временем) с методами: getDateSpecialFormat(метод возвращающий дату в формате "yyMMdd"), getTimeSpecialFormat( метод возвращающий дату в формате "HHmmss"), addMinutes(метод прибавляющий к переданной дате в аргументе определённое количество минут)
+ Класс Global(хранит поля доступные всему приложению, а именно поле с адресом сервера "https://cbook.belcraft.ru")
+ Класс Internet(работа с сетью) с методами: checkInternetConenction(метод проверяющий соединение с интернетом), serverIsReachable(метод проверяющий доступен ли сервер)
+ Класс Settings(доступ к настройкам приложения) с методами: setValue(метод задающий значения), getValue(метод получающий значения)
+ Класс SyncSomeTable(позволяет синхронизировать таблицы с сервером)с методами: Update(метод возвращающий данные с сервера),Upgrade(метод для загрузки данных на сервер)
+ Класс UriBuilder(составляет URI для DbProvider) с методом getUri(метод возвращающий URI составленной на основе аргументов)

Для добавления нового рецепта необходимо нажать на кнопку «Добавить рецепт». Отобразиться страница «Добавить рецепт». Необходимо ввести название рецепта, описание приготовления и время приготовления. Также выберите категорию вашего рецепта из предложенного списка и используемые продукты в вашем рецепте, а напротив выбранных продуктов введите их количество. Если же в предложенном списке продуктов нет нужного вам, тогда необходимо выбрать «Добавить продукт» в верхнем меню данной страницы. Отобразиться страница «Добавить продукт», где в поле вам необходимо ввести название продукта и нажать на кнопку «Добавить продукт». После этого вы вернетесь на страницу «Добавить рецепт» для продолжения заполнения информации о рецепте.

![Image alt](https://github.com/sutulayaDog/CookBook/blob/main/%D1%84%D0%BE%D1%82%D0%BE6.jpg)

Когда вся информация заполнена, нажимаем на кнопку «Добавить рецепт». Появиться всплывающее сообщение «Добавлено» и откроется главная страница приложения.
Для реализации добавление нового рецепта и нового продукта используются классы: AddProductActivity(добавление нового продукта) и AddRecipeActivity(добавление и изменение рецепта) с методами: 
+ fillSpinner(метод выполняющий заполнение выпадающих списков отображаемых в активности),
+ setData(метод заполнения полей ввода и выбора значения из выпадающих списков при изменении рецепта),
+ addResipe_onClick(метод привязанный к событию нажатия на кнопку «Добавить рецепт»),
+ updateResipe_onClick(метод привязанный к событию нажатия на кнопку «Изменить рецепт»).

Для того чтобы посмотреть рецепты, вам необходимо на главной странице выберать кнопку «Посмотреть рецепт». Вам будет предоставлена страница «Выбор» с кнопками «Посмотреть все рецепты» и «Выбрать категорию».
Если вы выбираете «Посмотреть все рецепты» вам будет предоставлена страница «Все рецепты» со списком всех рецептов. 
Для поиска рецепта необходимо нажать на иконку лупы и ввести название нужного рецепта.
При нажатии на название рецепта вам будет предоставлена страница «Рецепт» со всей информацией о выбранном рецепте, а именно, название, время приготовления, продукты, которые используются, и описание приготовление рецепта.

![Image alt](https://github.com/sutulayaDog/CookBook/blob/main/%D1%84%D0%BE%D1%82%D0%BE7.jpg)

Для просмотра списка всех рецептов и самого рецепта реализованы классы: AllResipeActivity(отображение списка рецептов) с методами: 
+ defaultItemClickOfList(метод привязанный к событию нажатия на элемент списка),
+ defaultLongClickListener(метод привязанный к событию долго удержания пальца на элементе списка),
+ loadLists(метод загрузки всех рецептов) 
и ResipeActivity(отображение описания конкретного рецепта).

Также пользователю запрещено делать скриншот рецепта с помощью строки в методе onCreat:
getWindow().setFlags(WindowManager.LayoutParams.FLAG_SECURE, WindowManager.LayoutParams.FLAG_SECURE);

При необходимости изменить некоторую информацию в рецепте удерживайте пальцем название необходимого рецепта из списка до появления, всплывающего меню и нажмите на «Изменить». Появиться страница «Изменить рецепт» в которой вы можете изменить необходимые вам поля и после этого нажмите на кнопку «Изменить рецепт». На это странице в верхнем меню, также можно добавить продукт, если в списке продуктов нет необходимого вам. 

![Image alt](https://github.com/sutulayaDog/CookBook/blob/main/%D1%84%D0%BE%D1%82%D0%BE8.jpg)

При необходимости удалить рецепт удерживайте пальцем название необходимого рецепта из списка до появления, всплывающего меню и нажмите на «Удалить». Появиться окно подтверждения действий «Уверены?». Нажмите на «Да», если вы уверены или на «Нет», если передумали удалять рецепт.

Когда вам необходимы рецепты определенной категории на странице «Выбор» нажмите на «Выбрать категорию». Вам будет предоставлена страница «Категории».

![Image alt](https://github.com/sutulayaDog/CookBook/blob/main/%D1%84%D0%BE%D1%82%D0%BE9.jpg)

При нажатии на необходимую вам категорию из списка, будет предоставлена страница «Рецепты из выбранной категории». Все действия над рецептами производятся точно также, как и на странице с всеми рецептами.
Для работы с категориями реализованы классы: CategorieResipeActivity(отображение списка категорий) с методом:
+ loadLists(метод загрузки списка категории) 
и класс CategorieActivity(отображение рецептов из выбранной категории) с методами:
+ defaultItemClickOfList(метод привязанный к событию нажатия на элемент списка), 
+ defaultLongClickListener(метод привязанный к событию долго удержания пальца на элементе списка), 
+ loadLists(метод загрузки рецептов выбранной категории).

Также на главной странице в верхнем меню можно выбрать «Таймер». Вам представится страница «Таймер» в которой можно установить необходимое вам время в минутах. По истечению этого времени будет играть короткая мелодия, которая свидетельствует об окончании установленного времени.
Таймер реализован с помощью класса TimerActivity с методами: 
+ setTime(метод устанавливающий время)
+ startTimer(метод запускающий таймер)
+ pauseTimer(метод ставящий таймер на паузу)
+ resetTimer(метод сбрасывающий таймер)
+ updateCountDownText(метод обновляющий текст в TextView)
+ updateWatchInterface(метод обновляющий интерфейс страницы при старте/конце/паузе таймера)

Если вам необходимы некоторые интересные факты и советы о готовке, тогда на главной странице в верхнем меню выберите «Лайфхаки для готовки». Будет отображена страница «Лайфхаки для готовки» с картинкой. Для просмотра всех картинок с советами необходимо «свайпать» вправо или влево.
Лайфхаки для готовки реализованы с помощью класса LifeHackActivity с методами: 
+ setPositionNext(метод возвращающий следующее положение картинки)
+ setPositionPrev(метод возвращающий предыдущее положение картинки)
+ makeView(метод создающий картинку в ImageView)
+ onTouchEvent(метод возвращающий событие касания на картинку)
+ onFling(метод возвращающий событие «свайпа» картинки влево и вправо)

Если вы добавляли, изменяли или удаляли информацию во время работы с приложением, тогда вам необходимо, повторно, на главной странице в верхнем меню выбрать «Синхронизация».

Также для мобильного приложения предусмотрена обфускация кода. В build.gradle необходимо мзмените свойство minifyEnabled с false на true. 
После декомпиляции apk файла получим файл classes2.dex. Открыв который сможем увидеть только название классов и методов в нашем apk. 

![Image alt](https://github.com/sutulayaDog/CookBook/blob/main/classes2.png)

# Сервер

https://github.com/sutulayaDog/CookBook/tree/main/CookBookAPI 

Серверная часть приложения предоставляет API для доступа к каждой сущности в базе данных. 

Передаваемые или получаемые данные от сервера передаваются в формате JSON. 
Серверное приложение построено на основе архитектурного стиля REST и использоваться для взаимодействия компонентов распределённого приложения в сети.
При обращении к серверу по заданному маршруту и определенному HTTP методу сервер будет определять с какой сущностью базы данных необходимо взаимодействовать и какие действия над данными необходимо будет произвести.
При помощи HTTP метода GET сервер будет возвращать данные клиенту, ссылаясь на аргументы в запросе, как на условие для выборки данных. Метод POST в свою очередь позволяет передать данные на сервер для последующей обработки.

Механизм синхронизации между серверным приложением и клиентским приложением представлено схемой

![Image alt](https://github.com/sutulayaDog/CookBook/blob/main/%D1%81%D1%85%D0%B5%D0%BC%D0%B0.png)


Сервер был реализовано в среде разработки – Microsoft Visual Studio 2019. Для написания приложения был использован язык программирования C#.
Для хранения данных использована СУБД MySQL.

Сервер имеет контроллеры:
Класс ProductInResipeController(контроллер таблицы продукт в рецепте) с методами:
+ Update(метод отправляющий данные клиенту для обновления)
+ Upgrade(метод обрабатывает полученные данные для обновления)
+ AddNewRecord(метод добавляющий новую запись в таблицу продукты, если та отсутствует в базе данных)
Класс ResipeController(контроллер таблицы рецепт) с методами:
+ Update(метод отправляющий данные клиенту для обновления)
+ Upgrade(метод обрабатывает полученные данные для обновления)
+ AddNewRecord(метод добавляющий новую запись в таблицу продукты, если та отсутствует в базе данных)
Класс StatusController(контроллер определяющий работу сервера) с методом GetInfo(метод возвращающий информацию о текущем времни)

Также сервер имеет модели, которые позволяют представить данные базы данных в виде объектов:
Класс Categorie (описание объекта категории) со свойствам:
+ IdCategorie	Свойство содержащее идентификатор категории
+ Name	Свойство содержащее имя категории
+ DateLastChange	Свойство содержащее дату последнего изменения категории
+ TimeLastChange	Свойство содержащее время последнего изменения категории
+ Status	Свойство содержащее статус категории
Класс CookbookDbContext (определяет контекст данных, используемый для взаимодействия с базой данных)
Класс ModelShare(содержит общий код для каждой модели)
Класс Product(описание объекта продукт) со свойствами:
+ IdProduct	Свойство содержащее идентификатор продукта
+ Name	Свойство содержащее имя продукта
+ DateLastChange	Свойство содержащее дату последнего изменения продукта
+ TimeLastChange	Свойство содержащее время последнего изменения продукта
+ Status	Свойство содержащее статус продукта
Класс ProductInResipe(описание объекта продукт в рецепте) 
+ IdProductInResipe	Свойство содержащее идентификатор продукта в рецепте
+ IdProduct	Свойство содержащее идентификатор продукта
+ IdResipe	Свойство содержащее идентификатор рецепта
+ Quantity	Свойство содержащее количество продукта
+ DateLastChange	Свойство содержащее дату последнего изменения продукта в рецепте
+ TimeLastChange	Свойство содержащее время последнего изменения продукта в рецепте
+ Status	Свойство содержащее статус продукта в рецепте
Класс Resipe – описание объекта рецепт
+ IdResipe	Свойство содержащее идентификатор рецепта
+ IdCategorie	Свойство содержащее идентификатор категории
+ Name	Свойство содержащее имя рецепта
+ Description	Свойство содержащее описание рецепта
+ TimeCook	Свойство содержащее время приготовления рецепта
+ DateLastChange	Свойство содержащее дату последнего изменения рецепта
+ TimeLastChange	Свойство содержащее время последнего изменения рецепта
+ Status	Свойство содержащее статус рецепта

















